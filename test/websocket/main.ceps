kind Event;
kind Guard;
kind Systemstate;
Event ev,ev2;


Systemstate some_text;
some_text = "";

frame{
 id{frm;};
 text;/*binary*/
 data{some_text;};
};

receiver
{
 id { ws_server; };
 when { frm; };
 emit { ev; };
 transport
 {
  websocket_server;
  generic_tcp_in
  {
   port { 
    "8181"; 
   }; 
   ip {
    "127.0.0.1";
   };
  };
 };
};

sender
{
 id{ws_server_out;};
 transport {use { ws_server; };};
};

Systemstate counter;
counter = 0;

statemachine{
 print_websocket_message;
 states{Initial;};
 Actions{
  msg_arrived{
   print("Received data: ", argv(1),"\n");
   some_text = "123";
   send(frm,ws_server_out);
   counter = counter + 1;
  };
 };
 t{Initial;Initial;ev;msg_arrived;};
};


Simulation{Start{print_websocket_message;};};