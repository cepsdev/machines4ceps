kind Event;
kind Guard;
kind Systemstate;
Event ev,ev2;

frame{id{frm;};data{"Hello,world!";};};

receiver
{
 id { websocket_server; };
 when { frm; };
 emit { ev; };
 transport
 {
  websocket;
  generic_tcp_in
  {
   port { 
    "8181"; 
   }; 
   ip {
    "127.0.0.1";
   };
  };
 };
};

sender
{
  when { ev2; };emit { frm; };
  transport {use { websocket_server; };};
};

Systemstate counter;
counter = 0;

statemachine{
 print_websocket_message;
 states{Initial;};
 Actions{
  msg_arrived{
   print("Received data: ", argv(1),"\n");
   ev2("{\"signal\":"+counter+ "}");
   counter = counter + 1;
  };
 };
 t{Initial;Initial;ev;msg_arrived;};
};


Simulation{Start{print_websocket_message;};};