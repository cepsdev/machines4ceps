/*
 * 
 * @author Tomas Prerovsky <tomas.prerovsky@gmail.com> 
 * 
 * @section DESCRIPTION
 * 
 * A simple model of the iVeNet <-> TrgsBag  communication modeling the TrgsBAG part.
 * Echos any data received from iVeNet on every heartbeat.  
 * 
 */

Systemstate IVeNetNotifycounter,TrgsBagNotifycounter;
Event runtime_xml_exception;

Statemachine{
 id{Echo;};
 States{
   Initial;
   HeartbeatStarted;   
 };
 Actions{
  start_heart_beat{
    start_periodic_timer(1.0*s,TrgsBagNotify);    
  }; 
  print_input_values{
    print("IVeNetNotify occured (#",IVeNetNotifycounter,")\n");
    IVeNetNotifycounter = IVeNetNotifycounter + 1;
    print("*****************INPUT FROM IVENET****************\n");
    print("TrgsBagMastIn.ApplicationHeartbeat.TimeSource='",TrgsBagMastIn.ApplicationHeartbeat.TimeSource,"'\n");
    print("TrgsBagMastIn.ApplicationHeartbeat.Year='",TrgsBagMastIn.ApplicationHeartbeat.Year,"'\n");
    print("TrgsBagMastIn.ApplicationHeartbeat.Month='",TrgsBagMastIn.ApplicationHeartbeat.Month,"'\n");
    print("TrgsBagMastIn.ApplicationHeartbeat.Day='",TrgsBagMastIn.ApplicationHeartbeat.Day,"'\n");
    print("TrgsBagMastIn.ApplicationHeartbeat.Hour='",TrgsBagMastIn.ApplicationHeartbeat.Hour,"'\n");
    print("TrgsBagMastIn.ApplicationHeartbeat.Minute='",TrgsBagMastIn.ApplicationHeartbeat.Minute,"'\n");
    print("TrgsBagMastIn.ApplicationHeartbeat.Second='",TrgsBagMastIn.ApplicationHeartbeat.Second,"'\n");
    print("TrgsBagMastIn.ApplicationHeartbeat.AppVersion='",TrgsBagMastIn.ApplicationHeartbeat.AppVersion,"'\n");
   
    print("TrgsBagMastIn.OwnVehiclePosition.IsValid='",TrgsBagMastIn.OwnVehiclePosition.IsValid,"'\n");
    print("TrgsBagMastIn.OwnVehiclePosition.Coordinate.Latitude='",TrgsBagMastIn.OwnVehiclePosition.Coordinate.Latitude,"'\n");
    print("TrgsBagMastIn.OwnVehiclePositiont.Coordinate.Longitude='",TrgsBagMastIn.OwnVehiclePosition.Coordinate.Longitude,"'\n");
    print("TrgsBagMastIn.OwnVehiclePosition.Coordinate.Altitude='",TrgsBagMastIn.OwnVehiclePosition.Coordinate.Altitude,"'\n");
    
    
    print("TrgsBagMastIn.OwnVehicleAlignment.IsValid='",TrgsBagMastIn.OwnVehicleAlignment.IsValid,"'\n");
    print("TrgsBagMastIn.OwnVehicleAlignment.Azimuth='",TrgsBagMastIn.OwnVehicleAlignment.Azimuth,"'\n");
    
    print("TrgsBagMastIn.StatusMast.IsValid='",TrgsBagMastIn.StatusMast.IsValid,"'\n");
    print("TrgsBagMastIn.StatusMast.MastStatus='",TrgsBagMastIn.StatusMast.MastStatus,"'\n");
    
    print("TrgsBagMastIn.StateRadarPosition.IsValid='",TrgsBagMastIn.StateRadarPosition.IsValid,"'\n");
    print("TrgsBagMastIn.StateRadarPosition.IsRadarInParkposition='",TrgsBagMastIn.StateRadarPosition.IsRadarInParkposition,"'\n");
   
    print("**************************************************\n");
  };   
  print_output_values{
    print("TrgsBagNotify occured (#",TrgsBagNotifycounter,")\n");
    TrgsBagNotifycounter = TrgsBagNotifycounter + 1;
    print("*****************OUTPUT DATA****************\n");
    print("TrgsBagMastOut.ApplicationHeartbeat.TimeSource='",TrgsBagMastOut.ApplicationHeartbeat.TimeSource,"'\n");
    print("TrgsBagMastOut.ApplicationHeartbeat.Year='",TrgsBagMastOut.ApplicationHeartbeat.Year,"'\n");
    print("TrgsBagMastOut.ApplicationHeartbeat.Month='",TrgsBagMastOut.ApplicationHeartbeat.Month,"'\n");
    print("TrgsBagMastOut.ApplicationHeartbeat.Day='",TrgsBagMastOut.ApplicationHeartbeat.Day,"'\n");
    print("TrgsBagMastOut.ApplicationHeartbeat.Hour='",TrgsBagMastOut.ApplicationHeartbeat.Hour,"'\n");
    print("TrgsBagMastOut.ApplicationHeartbeat.Minute='",TrgsBagMastOut.ApplicationHeartbeat.Minute,"'\n");
    
    print("TrgsBagMastOut.ApplicationHeartbeat.Second='",TrgsBagMastOut.ApplicationHeartbeat.Second,"'\n");
    print("TrgsBagMastOut.ApplicationHeartbeat.AppVersion='",TrgsBagMastOut.ApplicationHeartbeat.AppVersion,"'\n");
    print("TrgsBagMastOut.StatusMast.IsValid='",TrgsBagMastOut.StatusMast.IsValid,"'\n");
    print("TrgsBagMastOut.StatusMast.MastStatus='",TrgsBagMastOut.StatusMast.MastStatus,"'\n");
    print("TrgsBagMastOut.StatusRadarEnabled.IsValid='",TrgsBagMastOut.StatusRadarEnabled.IsValid,"'\n");
    print("TrgsBagMastOut.StatusRadarEnabled.IsRadarWorkingEnabled='",TrgsBagMastOut.StatusRadarEnabled.IsRadarWorkingEnabled,"'\n");
    print("TrgsBagMastOut.StatusPlatform.IsValid='",TrgsBagMastOut.StatusPlatform.PlatformStatus,"'\n");
    print("TrgsBagMastOut.StatusPlatform.PlatformStatus='",TrgsBagMastOut.StatusPlatform.PlatformStatus,"'\n");
    print("TrgsBagMastOut.RadarParkpositionRequest.IsValid='",TrgsBagMastOut.RadarParkpositionRequest.IsValid,"'\n");
    print("TrgsBagMastOut.RadarParkpositionRequest.IsRequestActive='",TrgsBagMastOut.RadarParkpositionRequest.IsRequestActive,"'\n");
    print("**************************************************\n");
  };    
  copy_values{
    
  };  
  print_exception_info{
     print("***Error:'",argv(1),"'\n");
  };
 };
  
 
 //Transition syntax: FROMSTATE;TOSTATE followed by optional action/guard/event (in any order)
 
 Transition{Initial/*from*/;
            HeartbeatStarted/*to*/;
	    start_heart_beat/*action*/;
	    /*no triggering event=> epsilon transition*/};
 Transition{HeartbeatStarted;
            HeartbeatStarted;
	    IVenetNotify;
	    print_input_values;};
/* Transition{HeartbeatStarted;
            HeartbeatStarted;
	    TrgsBagNotify;
	    print_output_values;};	    
 Transition{HeartbeatStarted;
            HeartbeatStarted;
	    IVenetNotify;
	    copy_values;}*/;
 Transition{HeartbeatStarted;HeartbeatStarted;runtime_xml_exception;print_exception_info;};
 
};

Simulation{
 TrgsBagNotifycounter = 0;
 IVeNetNotifycounter = 0;
 Start{Echo;};
};
